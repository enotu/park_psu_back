databaseChangeLog:
  - changeSet:
      id: create-update-booking-time-trigger
      author: SofiaPalkina
      changes:
        - sql:
            splitStatements: false
            stripComments: true
            sql: |
              CREATE OR REPLACE FUNCTION update_booking_time()
                RETURNS trigger AS $$
                BEGIN
                  -- Если колонка is_occupied изменена, обновляем booking_time на текущее время
                  IF NEW.is_occupied <> OLD.is_occupied THEN
                  NEW.booking_time := NOW();
                  END IF;
                  RETURN NEW;
                END;
              $$ LANGUAGE plpgsql;

              CREATE TRIGGER update_booking_time_trigger
              BEFORE UPDATE ON places
              FOR EACH ROW
              EXECUTE FUNCTION update_booking_time();